function touchDown(a){globalStates.editingMode?(globalStates.editingModeObject=this.ObjectId,globalStates.editingModeLocation=this.location,globalStates.editingModeHaveObject=!0):globalStates.guiButtonState||globalProgram.ObjectA||(globalProgram.ObjectA=this.ObjectId,globalProgram.locationInA=this.location)}function falseTouchUp(){globalStates.guiButtonState||(globalProgram.ObjectA=!1,globalProgram.locationInA=!1);globalCanvas.hasContent=!0}
function trueTouchUp(){if(!globalStates.guiButtonState&&globalProgram.ObjectA){var a=!0,c=objectExp[globalProgram.ObjectA],d=c.objectLinks;globalProgram.ObjectB=this.ObjectId;globalProgram.locationInB=this.location;globalProgram.ObjectA===this.ObjectId&&globalProgram.locationInA===this.location&&(a=!1);for(var b in d)d[b].ObjectA===globalProgram.ObjectA&&d[b].ObjectB===globalProgram.ObjectB&&d[b].locationInA===globalProgram.locationInA&&d[b].locationInB===globalProgram.locationInB&&(a=!1);for(b in d)d[b].ObjectA===
globalProgram.ObjectB&&d[b].ObjectB===globalProgram.ObjectA&&d[b].locationInA===globalProgram.locationInB&&d[b].locationInB===globalProgram.locationInA&&(a=!1);a&&(a=Math.uuid(17),d[a]={ObjectA:globalProgram.ObjectA,locationInA:globalProgram.locationInA,ObjectB:globalProgram.ObjectB,locationInB:globalProgram.locationInB},uploadNewLink(c.ip,globalProgram.ObjectA,a,d[a]));globalProgram.ObjectA=!1;globalProgram.locationInA=!1;globalProgram.ObjectB=!1;globalProgram.locationInB=!1}globalCanvas.hasContent=
!0}function documentPointerUp(a){globalStates.guiButtonState||(falseTouchUp(),!globalProgram.ObjectA&&globalStates.drawDotLine&&deleteLines(globalStates.drawDotLineX,globalStates.drawDotLineY,a.clientX,a.clientY),globalStates.drawDotLine=!1);globalCanvas.hasContent=!0}function canvasPointerDown(a){globalStates.guiButtonState||globalStates.editingMode||globalProgram.ObjectA||(globalStates.drawDotLine=!0,globalStates.drawDotLineX=a.clientX,globalStates.drawDotLineY=a.clientY)}
function getPossition(a){globalStates.pointerPosition=[a.clientX,a.clientY]}function MultiTouchStart(a){a.preventDefault();globalStates.editingMode&&1===a.targetTouches.length&&(globalStates.editingModeObject=this.ObjectId,globalStates.editingModeLocation=this.location,globalStates.editingModeHaveObject=!0)}
function MultiTouchMove(a){a.preventDefault();if(globalStates.editingModeHaveObject&&globalStates.editingMode&&1===a.targetTouches.length){var c=a.touches[0];globalStates.editingModeObjectX=c.pageX;globalStates.editingModeObjectY=c.pageY;var d={},d=globalStates.editingModeObject!=globalStates.editingModeLocation?objectExp[globalStates.editingModeObject].objectValues[globalStates.editingModeLocation]:objectExp[globalStates.editingModeObject],b=multiplyMatrix(rotateX,multiplyMatrix(globalObjects[globalStates.editingModeObject],
globalStates.projectionMatrix));globalStates.angX=toAxisAngle(b)[0];globalStates.angY=toAxisAngle(b)[1];var f=b[3][2]*(c.pageX-globalStates.height/2),e=b[3][2]*(c.pageY-globalStates.width/2),c=-Math.sqrt(Math.pow(e,2)+Math.pow(e*globalStates.angY/2,2));0<e&&(c=-c);e=-Math.sqrt(Math.pow(f,2)+Math.pow(f*globalStates.angX/2,2));0<f&&(e=-e);f=[[b[0][0],b[0][1],b[0][2],b[0][3]],[b[1][0],b[1][1],b[1][2],b[1][3]],[b[2][0],b[2][1],b[2][2],b[2][3]],[e,c,b[3][2],b[3][3]]];b=invertMatrix(b);b=multiplyMatrix(f,
b);d.x=b[3][0];d.y=b[3][1]}globalStates.editingModeHaveObject&&globalStates.editingMode&&2===a.targetTouches.length&&scaleEvent(a.touches[1])}
function MultiTouchEnd(a){a.preventDefault();globalStates.editingModeHaveObject&&(console.log("start"),a={},globalStates.editingModeObject===globalStates.editingModeLocation?(a.x=objectExp[globalStates.editingModeObject].x,a.y=objectExp[globalStates.editingModeObject].y,a.scale=objectExp[globalStates.editingModeObject].scale):(a.x=objectExp[globalStates.editingModeObject].objectValues[globalStates.editingModeLocation].x,a.y=objectExp[globalStates.editingModeObject].objectValues[globalStates.editingModeLocation].y,
a.scale=objectExp[globalStates.editingModeObject].objectValues[globalStates.editingModeLocation].scale),postData("http://"+objectExp[globalStates.editingModeObject].ip+":"+httpPort+"/object/"+globalStates.editingModeObject+"/size/"+globalStates.editingModeLocation,a),globalStates.editingModeHaveObject=!1);globalCanvas.hasContent=!0}
function MultiTouchCanvasStart(a){a.preventDefault();globalStates.editingModeHaveObject&&globalStates.editingMode&&1===a.targetTouches.length&&(a=a.touches[1],globalStates.editingScaleX=a.pageX,globalStates.editingScaleY=a.pageY,globalStates.editingScaledistance=Math.sqrt(Math.pow(globalStates.editingModeObjectX-globalStates.editingScaleX,2)+Math.pow(globalStates.editingModeObjectY-globalStates.editingScaleY,2)),a={},a=globalStates.editingModeObject!=globalStates.editingModeLocation?objectExp[globalStates.editingModeObject].objectValues[globalStates.editingModeLocation]:
objectExp[globalStates.editingModeObject],globalStates.editingScaledistanceOld=a.scale)}function MultiTouchCanvasMove(a){a.preventDefault();globalStates.editingModeHaveObject&&globalStates.editingMode&&1===a.targetTouches.length&&scaleEvent(a.touches[1])}
function scaleEvent(a){var c=Math.sqrt(Math.pow(globalStates.editingModeObjectX-a.pageX,2)+Math.pow(globalStates.editingModeObjectY-a.pageY,2)),d=(c-globalStates.editingScaledistance)/300+globalStates.editingScaledistanceOld,b={},b=globalStates.editingModeObject!=globalStates.editingModeLocation?objectExp[globalStates.editingModeObject].objectValues[globalStates.editingModeLocation]:objectExp[globalStates.editingModeObject];.2>d&&(d=.2);b.scale=d;globalCanvas.context.clearRect(0,0,globalCanvas.canvas.width,
globalCanvas.canvas.height);drawBlue(globalCanvas.context,[globalStates.editingModeObjectX,globalStates.editingModeObjectY],[a.pageX,a.pageY],globalStates.editingScaledistance);c<globalStates.editingScaledistance?drawRed(globalCanvas.context,[globalStates.editingModeObjectX,globalStates.editingModeObjectY],[a.pageX,a.pageY],c):drawGreen(globalCanvas.context,[globalStates.editingModeObjectX,globalStates.editingModeObjectY],[a.pageX,a.pageY],c)}
function postData(a,c){var d=new XMLHttpRequest,b=JSON.stringify(c);d.open("POST",a,!0);d.onreadystatechange=function(){4==d.readyState&&console.log("It worked!")};d.setRequestHeader("Content-type","application/json");d.send(b)}function deleteData(a){var c=new XMLHttpRequest;c.open("DELETE",a,!0);c.onreadystatechange=function(){4==c.readyState&&console.log("It deleted!")};c.setRequestHeader("Content-type","application/json");c.send()}
function uploadNewLink(a,c,d,b){console.log("sending Link");postData("http://"+a+":"+httpPort+"/object/"+c+"/link/"+d,b)}function deleteLinkFromObject(a,c,d){console.log("I am deleting a link: "+a);deleteData("http://"+a+":"+httpPort+"/object/"+c+"/link/"+d)}
function addEventHandlers(){globalCanvas.canvas.addEventListener("touchstart",MultiTouchCanvasStart,!1);globalCanvas.canvas.addEventListener("touchmove",MultiTouchCanvasMove,!1);for(var a in objectExp){var c=objectExp[a];if(document.getElementById(a)){var d=document.getElementById(a);globalStates.guiButtonState&&(d.style.visibility="visible");d.addEventListener("touchmove",MultiTouchMove,!1);d.addEventListener("touchend",MultiTouchEnd,!1)}for(var b in c.objectValues)document.getElementById(b)&&(c=
document.getElementById(b),c.addEventListener("touchmove",MultiTouchMove,!1),c.addEventListener("touchend",MultiTouchEnd,!1))}}
function removeEventHandlers(){globalCanvas.canvas.removeEventListener("touchstart",MultiTouchCanvasStart,!1);globalCanvas.canvas.removeEventListener("touchmove",MultiTouchCanvasMove,!1);for(var a in objectExp){var c=objectExp[a];if(document.getElementById(a)){var d=document.getElementById(a);d.style.visibility="hidden";d.removeEventListener("touchmove",MultiTouchMove,!1);d.removeEventListener("touchend",MultiTouchEnd,!1)}for(var b in c.objectValues)document.getElementById(b)&&(c=document.getElementById(b),
c.removeEventListener("touchmove",MultiTouchMove,!1),c.removeEventListener("touchend",MultiTouchEnd,!1))}};
