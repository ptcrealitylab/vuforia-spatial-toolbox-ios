/*


                                      .,,,;;,'''..
                                  .'','...     ..',,,.
                                .,,,,,,',,',;;:;,.  .,l,
                               .,',.     ...     ,;,   :l.
                              ':;.    .'.:do;;.    .c   ol;'.
       ';;'                   ;.;    ', .dkl';,    .c   :; .'.',::,,'''.
      ',,;;;,.                ; .,'     .'''.    .'.   .d;''.''''.
     .oxddl;::,,.             ',  .'''.   .... .'.   ,:;..
      .'cOX0OOkdoc.            .,'.   .. .....     'lc.
     .:;,,::co0XOko'              ....''..'.'''''''.
     .dxk0KKdc:cdOXKl............. .. ..,c....
      .',lxOOxl:'':xkl,',......'....    ,'.
           .';:oo:...                        .
                .cd,      ╔═╗┌┬┐┬┌┬┐┌─┐┬─┐    .
                  .l;     ║╣  │││ │ │ │├┬┘    '
                    'l.   ╚═╝─┴┘┴ ┴ └─┘┴└─   '.
                     .o.                   ...
                      .''''','.;:''.........
                           .'  .l
                          .:.   l'
                         .:.    .l.
                        .x:      :k;,.
                        cxlc;    cdc,,;;.
                       'l :..   .c  ,
                       o.
                      .,

              ╦ ╦┬ ┬┌┐ ┬─┐┬┌┬┐  ╔═╗┌┐  ┬┌─┐┌─┐┌┬┐┌─┐
              ╠═╣└┬┘├┴┐├┬┘│ ││  ║ ║├┴┐ │├┤ │   │ └─┐
              ╩ ╩ ┴ └─┘┴└─┴─┴┘  ╚═╝└─┘└┘└─┘└─┘ ┴ └─┘ (not even) Alpha


 Created by Valentin on 10/22/14.

*/
function addHeartbeatObject(a){a.id&&(objectExp[a.id]||getData("http://"+a.ip+":"+httpPort+"/object/"+a.id,a.id,function(a,c){objectExp[c]=a}))}
function action(a){var b=JSON.parse(a);b.reloadLink&&getData("http://"+b.reloadLink.ip+":"+httpPort+"/object/"+b.reloadLink.id,b.reloadLink.id,function(a,b){objectExp[b].objectLinks=a.objectLinks;console.log("got links")});b.reloadObject&&getData("http://"+b.reloadObject.ip+":"+httpPort+"/object/"+b.reloadObject.id,b.reloadObject.id,function(a,b){objectExp[b].x=a.x;objectExp[b].y=a.y;objectExp[b].scale=a.scale;objectExp[b].objectValues=a.objectValues;console.log("got links")});console.log("founs action: "+
JSON.parse(a).reloadLink.id)}function getData(a,b,c){var d=new XMLHttpRequest;try{d.open("GET",a,!0),d.onreadystatechange=function(){4===d.readyState&&(200<=d.status&&400>d.status?c(JSON.parse(d.responseText),b):console.log("could not load content"))},d.send()}catch(e){console.log("could not connect to"+a)}}
function setProjectionMatrix(a){var b=[[globalStates.height,0,0,0],[0,-globalStates.width,0,0],[0,0,1,0],[0,0,0,1]];globalStates.projectionMatrix=multiplyMatrix(multiplyMatrix([[1,0,0,0],[0,1,0,0],[0,0,2,0],[0,0,0,1]],a),b);window.location.href="of://gotProjectionMatrix"}var conalt="";
function update(a){0==globalStates.feezeButtonState&&(globalObjects=a);""!==consoleText&&(consoleText="",document.getElementById("consolelog").innerHTML="");conalt="";!0===globalCanvas.hasContent&&(globalCanvas.context.clearRect(0,0,globalCanvas.canvas.width,globalCanvas.canvas.height),globalCanvas.hasContent=!1);for(var b in objectExp){a=objectExp[b];if(globalObjects[b]){a.visibleCounter=timeForContentLoaded;a.ObjectVisible=!0;var c=multiplyMatrix(rotateX,multiplyMatrix(globalObjects[b],globalStates.projectionMatrix));
globalStates.guiButtonState?(drawTransformed(a,b,c,b),addElement(a,b,"http://"+a.ip+":"+httpPort+"/"+b.slice(0,-12)+"/")):hideTransformed(a,b,b);for(var d in a.objectValues){var e=a.objectValues[d];globalStates.guiButtonState?hideTransformed(e,d,b):(drawTransformed(e,d,c,b),addElement(e,d,"http://"+a.ip+":"+httpPort+"/plugin_modules/"+e.plugin+"/",b))}}else{a.ObjectVisible=!1;hideTransformed(a,b,b);for(d in a.objectValues)hideTransformed(a.objectValues[d],d,b);killObjects(a,b)}globalStates.logButtonState&&
(consoleText+=JSON.stringify(a.objectLinks),consoleText+=objectLog(b))}if(!globalStates.guiButtonState&&!globalStates.editingMode){for(var f in objectExp)drawAllLines(objectExp[f],globalCanvas.context);drawInteractionLines()}globalStates.logButtonState&&generalLog(consoleText);globalStates.preferencesButtonState&&addElementInPreferences()}
function drawTransformed(a,b,c,d){globalStates.notLoading!==b&&!0===a.loaded&&(!a.visible&&(document.getElementById("iframe"+b).style.visibility="visible",a.visible=!0,globalStates.editingMode||d!==b)&&(document.getElementById(b).style.visibility="visible"),c=multiplyMatrix([[a.scale,0,0,0],[0,a.scale,0,0],[0,0,1,0],[a.x,a.y,0,1]],c),document.getElementById("thisObject"+b).style.webkitTransform="matrix3d("+c[0][0]+","+c[0][1]+","+c[0][2]+","+c[0][3]+","+c[1][0]+","+c[1][1]+","+c[1][2]+","+c[1][3]+
","+c[2][0]+","+c[2][1]+","+c[2][2]+","+c[2][3]+","+c[3][0]+","+c[3][1]+","+c[3][2]+","+c[3][3]+")",a.screenX=c[3][0]/c[3][2]+globalStates.height/2,a.screenY=c[3][1]/c[3][2]+globalStates.width/2,a.screenZ=c[3][2])}function hideTransformed(a,b,c){!0===a.visible&&(document.getElementById("iframe"+b).style.visibility="hidden",a.visible=!1,document.getElementById(b).style.visibility="hidden")}
function addElementInPreferences(){var a;a="<div class='Interfaces' style='position: relative;  float: left; height: 20px; width: 35%; text-align: center; font-family: Helvetica Neue, Helvetica, Arial;background-color: #3c3c3c; -webkit-transform-style: preserve-3d;'>Name</div><div class='Interfaces' style='position: relative;  float: left; height: 20px; width: 30%; text-align: center; font-family: Helvetica Neue, Helvetica, Arial;background-color: #3c3c3c; -webkit-transform-style: preserve-3d;'>IP</div>";a+=
"<div class='Interfaces' style='position: relative;  float: left; height: 20px; width: 16%; text-align: center; font-family: Helvetica Neue, Helvetica, Arial;background-color: #3c3c3c; -webkit-transform-style: preserve-3d; '>Version</div>";a+="<div class='Interfaces' style='position: relative;  float: left; height: 20px; width: 7%; text-align: center; font-family: Helvetica Neue, Helvetica, Arial; background-color: #3c3c3c;-webkit-transform-style: preserve-3d;'>I/O Buttons</div>";a+="<div class='Interfaces' style='position: relative;  float: left; height: 20px; width: 12%; text-align: center; font-family: Helvetica Neue, Helvetica, Arial; background-color: #3c3c3c;-webkit-transform-style: preserve-3d;'>Links</div>";
var b=!1,c="",d;for(d in objectExp){b?(c="background-color: #353535;",b=!1):(c="background-color: #323232;",b=!0);a+="<div class='Interfaces' id='name"+d+"' style='position: relative;  float: left; height: 20px; width: 35%; text-align: center; font-family: Helvetica Neue, Helvetica, Arial;"+c+" -webkit-transform-style: preserve-3d; '>"+d.slice(0,-12)+"</div>";a+="<div class='Interfaces' id='name"+d+"' style='position: relative;  float: left; height: 20px; width: 30%; text-align: center; font-family: Helvetica Neue, Helvetica, Arial;"+
c+" -webkit-transform-style: preserve-3d; '>"+objectExp[d].ip+"</div>";a+="<div class='Interfaces' id='version"+d+"' style='position: relative;  float: left; height: 20px; width: 16%; text-align: center; font-family: Helvetica Neue, Helvetica, Arial; "+c+"-webkit-transform-style: preserve-3d;'>"+objectExp[d].version+"</div>";var e=0,f;for(f in objectExp[d].objectValues)e++;a+="<div class='Interfaces' id='io"+d+"' style='position: relative;  float: left; height: 20px; width: 7%;  text-align: center; font-family: Helvetica Neue, Helvetica, Arial;"+
c+"-webkit-transform-style: preserve-3d;'>"+e+"</div>";var e=0,g;for(g in objectExp[d].objectLinks)e++;a+="<div class='Interfaces' id='links"+d+"' style='position: relative;  float: left; height: 20px; width: 12%; text-align: center;  font-family: Helvetica Neue, Helvetica, Arial;"+c+"-webkit-transform-style: preserve-3d;'>"+e+"</div>"}document.getElementById("content2").innerHTML=a}
function addElement(a,b,c,d){if(!0!==globalStates.notLoading&&globalStates.notLoading!==b&&!0!==a.loaded){"undefined"===typeof d&&(d=b);a.loaded=!0;globalStates.notLoading=b;var e=document.createElement("div");e.id="thisObject"+b;e.style.width=globalStates.height+"px";e.style.height=globalStates.width+"px";e.style.visibility="hidden";e.className="main";document.getElementById("GUI").appendChild(e);c="<iframe id='iframe"+b+"' onload='on_load(\""+b+"\")' frameborder='0' style='width:"+a.frameSizeX+
"px; height:"+a.frameSizeY+"px;top:"+(globalStates.width-a.frameSizeX)/2+"px; left:"+(globalStates.height-a.frameSizeY)/2+"px; visibility: hidden;' src='"+c+"' class='main'></iframe>";c+="<div id='"+b+"' frameborder='0' style='width:"+a.frameSizeX+"px; height:"+a.frameSizeY+"px;top:"+(globalStates.width-a.frameSizeX)/2+"px; left:"+(globalStates.height-a.frameSizeY)/2+"px; visibility: visible;' class='mainProgram'></div>";document.getElementById("thisObject"+b).innerHTML=c;a=document.getElementById(b);
a.style["touch-action"]="none";a.handjs_forcePreventDefault=!0;a.addEventListener("pointerdown",touchDown,!1);a.addEventListener("pointerup",trueTouchUp,!1);globalStates.editingMode&&(a.addEventListener("touchmove",MultiTouchMove,!1),a.addEventListener("touchend",MultiTouchEnd,!1));a.ObjectId=d;a.location=b;a.style.visibility=b!==d?"visible":"hidden"}}
function killObjects(a,b){if(0<a.visibleCounter)a.visibleCounter--;else if(a.loaded){a.loaded=!1;var c=document.getElementById("thisObject"+b);c.parentNode.removeChild(c);for(var d in a.objectValues)c=document.getElementById(d),c.parentNode.removeChild(c),a.objectValues[d].loaded=!1}}function on_load(a){globalStates.notLoading=!1;var b={id:a};document.getElementById("iframe"+a).contentWindow.postMessage(JSON.stringify(b),"*")}function fire(a){window.location.href="of://event_"+this.location};
